# üêõ –û—Ç–ª–∞–¥–∫–∞ –æ—à–∏–±–∫–∏ "Unexpected token 'R', Request En..."

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –Ω–∞ —Å–∞–π—Ç –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:
```
Unexpected token 'R', "Request En"... is not valid JSON
```

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:
1. ‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω MEGA –∞–∫–∫–∞—É–Ω—Ç
2. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω –ø–∞—Ä–æ–ª—å –Ω–∞ `Salam123!`
3. ‚úÖ MEGA –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ (—Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω)
4. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –∫–æ–¥–µ
5. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `.env.local` —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º

## ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å –≤ Vercel

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –æ–±–Ω–æ–≤–∏–ª–∏ `MEGA_PASSWORD` –≤ Vercel:

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://vercel.com/dashboard
2. –ü—Ä–æ–µ–∫—Ç `sechenov-plus` ‚Üí Settings ‚Üí Environment Variables
3. –ù–∞–π–¥–∏—Ç–µ `MEGA_PASSWORD`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ: `Salam123!`
5. –ï—Å–ª–∏ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ - –∏–∑–º–µ–Ω–∏—Ç–µ –∏ —Å–¥–µ–ª–∞–π—Ç–µ Redeploy

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ç–æ–º, —á—Ç–æ –≤–∞—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–¥–æ–±—Ä–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.

**–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:**
```sql
SELECT id, email, fullName, role, status 
FROM "User" 
WHERE email = '–≤–∞—à-email@example.com';
```

**–°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `APPROVED`**. –ï—Å–ª–∏ `PENDING`, –Ω—É–∂–Ω–æ –æ–¥–æ–±—Ä–∏—Ç—å:

```sql
UPDATE "User" 
SET status = 'APPROVED' 
WHERE email = '–≤–∞—à-email@example.com';
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://vercel.com/dashboard
2. –ü—Ä–æ–µ–∫—Ç `sechenov-plus` ‚Üí Deployments
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É **Functions**
5. –ù–∞–π–¥–∏—Ç–µ `/api/materials/external-upload`
6. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö:**
- `MEGA storage not configured` - MEGA credentials –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
- `Unauthorized` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω –∏–ª–∏ –Ω–µ –æ–¥–æ–±—Ä–µ–Ω
- `EBLOCKED` - MEGA –∞–∫–∫–∞—É–Ω—Ç –≤—Å—ë –µ—â—ë –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
- `ENOENT` - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å MEGA
- –î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://sechenov-plus.vercel.app/materials/upload
2. –ù–∞–∂–º–∏—Ç–µ **F12** (–æ—Ç–∫—Ä—ã—Ç—å DevTools)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É **Console**
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
5. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

**–°–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª–∏ –æ—á–µ–Ω—å –ø–æ–º–æ–∂–µ—Ç!**

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network –∑–∞–ø—Ä–æ—Å

1. –í DevTools –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É **Network**
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
3. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/materials/external-upload`
4. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ
5. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ:
   - **Status Code** (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 200, –µ—Å–ª–∏ –≤—Å—ë –æ–∫)
   - **Response** (—á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–µ—Ä–Ω—É–ª —Å–µ—Ä–≤–µ—Ä)
   - **Headers** ‚Üí **Content-Type** (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `application/json`)

---

## üß™ –¢–µ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ç–æ—á–Ω—É—é –æ—à–∏–±–∫—É, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ:

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä:
```bash
npm run dev
```

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
http://localhost:3000/materials/upload
```

### 3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π PDF/DOCX —Ñ–∞–π–ª

### 4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
- –¢–∞–º –±—É–¥—É—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –æ—à–∏–±–∫–∏ –æ—Ç MEGA
- –í—Å–µ `logger.error()` –∏ `logger.info()` –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å

---

## üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏

### –ü—Ä–∏—á–∏–Ω–∞ 1: –ü–∞—Ä–æ–ª—å –Ω–µ –æ–±–Ω–æ–≤–ª—ë–Ω –≤ Vercel
**–°–∏–º–ø—Ç–æ–º—ã**: MEGA –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –Ω–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç—å `MEGA_PASSWORD` –≤ Vercel –∏ Redeploy

### –ü—Ä–∏—á–∏–Ω–∞ 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–¥–æ–±—Ä–µ–Ω (status != APPROVED)
**–°–∏–º–ø—Ç–æ–º—ã**: –û—à–∏–±–∫–∞ `Unauthorized` (–∫–æ–¥ 401)
**–†–µ—à–µ–Ω–∏–µ**: –û–¥–æ–±—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

### –ü—Ä–∏—á–∏–Ω–∞ 3: MEGA API –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
**–°–∏–º–ø—Ç–æ–º—ã**: –û—à–∏–±–∫–∞ `ETEMPUNAVAIL` –≤ –ª–æ–≥–∞—Ö
**–†–µ—à–µ–Ω–∏–µ**: –ü–æ–¥–æ–∂–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞

### –ü—Ä–∏—á–∏–Ω–∞ 4: –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å MEGA –Ω–µ–≤–µ—Ä–Ω—ã–π
**–°–∏–º–ø—Ç–æ–º—ã**: –û—à–∏–±–∫–∞ `ENOENT (-9): Wrong password?`
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å, –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–æ–π—Ç–∏ –Ω–∞ mega.nz –≤—Ä—É—á–Ω—É—é

### –ü—Ä–∏—á–∏–Ω–∞ 5: NextAuth session –∏—Å—Ç—ë–∫
**–°–∏–º–ø—Ç–æ–º—ã**: `session` undefined –∏–ª–∏ null
**–†–µ—à–µ–Ω–∏–µ**: –í—ã–π—Ç–∏ –∏ —Å–Ω–æ–≤–∞ –≤–æ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç

### –ü—Ä–∏—á–∏–Ω–∞ 6: Vercel Function timeout
**–°–∏–º–ø—Ç–æ–º—ã**: –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä—ã–≤–∞–µ—Ç—Å—è, —Ç–∞–π–º–∞—É—Ç —á–µ—Ä–µ–∑ 10-60 —Å–µ–∫—É–Ω–¥
**–†–µ—à–µ–Ω–∏–µ**: –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π, —É–º–µ–Ω—å—à–∏—Ç—å –∏–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å `maxDuration` –≤ route.ts

---

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç –≤–∞—Å:

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏ –ø—Ä–∏—à–ª–∏—Ç–µ:

1. **–°–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console)** –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏
2. **–°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (PENDING –∏–ª–∏ APPROVED?)
3. **–õ–æ–≥–∏ –∏–∑ Vercel** (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø)
4. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ** –∏ –ø—Ä–∏—à–ª–∏—Ç–µ –æ—à–∏–±–∫—É –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É!

---

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è)

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç, –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ Supabase:

1. –ò–∑–º–µ–Ω–∏—Ç–µ –≤ `src/components/materials/MaterialUploadForm.tsx` —Å—Ç—Ä–æ–∫—É 95:
   ```typescript
   const needsExternalStorage = false; // –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º Supabase
   ```

2. –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É 16:
   ```typescript
   const MAX_SUPABASE_SIZE = 10 * 1024 * 1024; // –†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ 10MB –≤ Supabase
   ```

3. –ó–∞–ø—É—à—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
   ```bash
   git add .
   git commit -m "temp: switch to Supabase storage"
   git push
   ```

‚ö†Ô∏è –≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, —Ç–∞–∫ –∫–∞–∫ —É Supabase –ª–∏–º–∏—Ç 1GB –≤ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º –ø–ª–∞–Ω–µ.

