# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 413 - Vercel Payload Limit

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
413 (Content Too Large)
FUNCTION_PAYLOAD_TOO_LARGE
```

## –ü—Ä–∏—á–∏–Ω–∞
**Vercel –∏–º–µ–µ—Ç –∂—ë—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç 4.5MB –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ (payload)** –¥–ª—è Serverless Functions.

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ **–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã –±–æ–ª—å—à–µ 4.5MB —á–µ—Ä–µ–∑ Vercel API** (–¥–∞–∂–µ –Ω–∞ Pro –ø–ª–∞–Ω–µ).

### –ü–æ—á–µ–º—É MEGA –Ω–µ —Ä–∞–±–æ—Ç–∞–ª?
- MEGA API —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ Vercel Function
- –§–∞–π–ª –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑: –ë—Ä–∞—É–∑–µ—Ä ‚Üí Vercel Function ‚Üí MEGA
- –ï—Å–ª–∏ —Ñ–∞–π–ª > 4.5MB, Vercel –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 413 –æ—à–∏–±–∫—É
- MEGA credentials –±—ã–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ, –Ω–æ Vercel –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –∑–∞–ø—Ä–æ—Å

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ Supabase Storage

Supabase Storage —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ-–¥—Ä—É–≥–æ–º—É:
- –§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è **–Ω–∞–ø—Ä—è–º—É—é —Å –±—Ä–∞—É–∑–µ—Ä–∞ –≤ Supabase**
- –ù–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ Vercel Function
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ 4.5MB
- –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã –¥–æ 50MB (–ª–∏–º–∏—Ç Supabase –Ω–∞ Free –ø–ª–∞–Ω–µ)

### –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ:

**–§–∞–π–ª**: `src/components/materials/MaterialUploadForm.tsx`

1. **–ò–∑–º–µ–Ω—ë–Ω MAX_SUPABASE_SIZE**:
   ```typescript
   // –ë—ã–ª–æ:
   const MAX_SUPABASE_SIZE = 0; // ALL materials go to MEGA
   
   // –°—Ç–∞–ª–æ:
   const MAX_SUPABASE_SIZE = 10 * 1024 * 1024; // Use Supabase for files up to 10MB
   ```

2. **–û—Ç–∫–ª—é—á–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –≤ MEGA**:
   ```typescript
   // –ë—ã–ª–æ:
   const needsExternalStorage = true; // Always use MEGA
   
   // –°—Ç–∞–ª–æ:
   const needsExternalStorage = false; // Use Supabase Storage
   ```

3. **–û–±–Ω–æ–≤–ª–µ–Ω–æ UI —Å–æ–æ–±—â–µ–Ω–∏–µ**:
   - –í–º–µ—Å—Ç–æ "–±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –≤ MEGA" ‚Üí "–±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –≤ Supabase"
   - –ò–∑–º–µ–Ω—ë–Ω —Ü–≤–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞ (purple ‚Üí blue)

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â

| –ö—Ä–∏—Ç–µ—Ä–∏–π | MEGA (—á–µ—Ä–µ–∑ Vercel) | Supabase Storage |
|----------|---------------------|------------------|
| **–ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞** | ‚ùå 4.5MB (Vercel limit) | ‚úÖ –î–æ 50MB (Free plan) |
| **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** | 20GB | 1GB |
| **–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏** | –ú–µ–¥–ª–µ–Ω–Ω–æ (—á–µ—Ä–µ–∑ API) | –ë—ã—Å—Ç—Ä–æ (–ø—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞) |
| **–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| **Client-side upload** | ‚ùå –ù–µ—Ç (–Ω—É–∂–µ–Ω proxy) | ‚úÖ –î–∞ |

---

## üöÄ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞)

### –í–∞—Ä–∏–∞–Ω—Ç 1: Supabase Pro ($25/–º–µ—Å)
- 100GB —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫
- –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 2: AWS S3 / Cloudflare R2
- Client-side upload —á–µ—Ä–µ–∑ presigned URLs
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Vercel
- R2: –±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 10GB
- S3: ~$0.023/GB

### –í–∞—Ä–∏–∞–Ω—Ç 3: Vercel Blob Storage
- –°–æ–∑–¥–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è Vercel
- –î–æ 100MB –Ω–∞ —Ñ–∞–π–ª (Hobby plan)
- $0.15/GB/–º–µ—Å—è—Ü

### –í–∞—Ä–∏–∞–Ω—Ç 4: MEGA (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MEGA, –Ω–æ –Ω—É–∂–Ω–æ:
1. –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π API endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è presigned upload URL
2. –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª —Å –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞–ø—Ä—è–º—É—é –≤ MEGA —á–µ—Ä–µ–∑ –∏—Ö SDK
3. –ò–∑–±–µ–≥–∞—Ç—å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ Vercel Function

**–ù–æ —ç—Ç–æ —Å–ª–æ–∂–Ω–æ** –∏ –Ω–µ —Å—Ç–æ–∏—Ç —É—Å–∏–ª–∏–π –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.

---

## ‚úÖ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ **Supabase Storage**
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: **10MB**
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ **–Ω–∞–ø—Ä—è–º—É—é —Å –±—Ä–∞—É–∑–µ—Ä–∞** (–±—ã—Å—Ç—Ä–æ)
- ‚úÖ –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Vercel 4.5MB
- ‚ö†Ô∏è –õ–∏–º–∏—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: **1GB** (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω Supabase)

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Supabase:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://supabase.com/dashboard)
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
3. Settings ‚Üí Usage
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ "Storage" - —Å–∫–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ

–ö–æ–≥–¥–∞ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ—Å—å –∫ 1GB, –º–æ–∂–Ω–æ:
- –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ/–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∞–π–ª—ã
- –ê–ø–≥—Ä–µ–π–¥ –¥–æ Pro –ø–ª–∞–Ω–∞ ($25/–º–µ—Å = 100GB)
- –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

---

## üìù –î–ª—è –±—É–¥—É—â–µ–π –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏

–ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –≤—ã—Ä–∞—Å—Ç–µ—Ç –∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞:

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ **Cloudflare R2**
- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 10GB
- –ù–µ—Ç –ø–ª–∞—Ç—ã –∑–∞ –∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ (–≤—ã–≥–æ–¥–Ω–æ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏–π)
- –õ–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å (S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API)
- Client-side upload —á–µ—Ä–µ–∑ presigned URLs

---

## üîç –ü–æ—á–µ–º—É –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vercel –¥–ª—è —Ñ–∞–π–ª–æ–≤?

Vercel Serverless Functions **–Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤**:
- –õ–∏–º–∏—Ç payload: 4.5MB
- –õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 10 —Å–µ–∫ (Hobby), 60 —Å–µ–∫ (Pro)
- –ù–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–≥—Ä—É–∑–æ–∫

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (Supabase, S3, R2, Blob Storage)

---

## ‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å

1. **–ó–∞–ø—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Git**:
   ```bash
   git add .
   git commit -m "fix: switch to Supabase Storage due to Vercel 4.5MB payload limit"
   git push
   ```

2. **–ü–æ–¥–æ–∂–¥–∞—Ç—å –¥–µ–ø–ª–æ—è Vercel** (~2 –º–∏–Ω—É—Ç—ã)

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–∞** –Ω–∞ https://sechenov-plus.vercel.app/materials/upload

4. **–î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å!** üéâ

---

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å**: ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞, –≥–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é
